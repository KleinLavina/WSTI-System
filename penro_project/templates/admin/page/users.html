{% extends "admin/layout/base.html" %}
{% block title %}Users{% endblock %}
{% block content %}

<!-- =========================
     HEADER
========================= -->
<div class="users-header">
  <div>
    <h3 class="fw-bold mb-0">
      Users
      <span class="user-count">{{ total_users }}</span>
    </h3>
    <div class="text-muted small">
      TIWI Reference · User Directory
    </div>
  </div>

  <a href="#"
    class="btn-add-user"
    data-bs-toggle="modal"
    data-bs-target="#createUserModal">
    + Add User
  </a>

</div>

<div class="user-filters">

  <!-- SEARCH -->
  <input
    type="text"
    class="filter-input"
    placeholder="Search user (name, username, email)"
    disabled
  >

  <!-- ORG FILTERS (STATIC) -->
  <select class="filter-select" disabled>
    <option>All Divisions</option>
  </select>

  <select class="filter-select" disabled>
    <option>All Sections</option>
  </select>

  <select class="filter-select" disabled>
    <option>All Services</option>
  </select>

  <select class="filter-select" disabled>
    <option>All Units</option>
  </select>

</div>

<hr class="my-3">

<!-- =========================
     USER GRID
========================= -->
<div class="user-grid">

{% for user in users %}

<div class="user-card">

  <!-- TOP LEFT: DIVISION -->
  <span class="badge badge-division">
    {{ user.division.name|default:"No Division" }}
  </span>

  <!-- TOP RIGHT: ROLE -->
  <span class="badge badge-role {% if user.login_role == 'admin' %}admin{% else %}user{% endif %}">
    {{ user.get_login_role_display }}
  </span>

  <!-- CENTER CONTENT -->
  <div class="user-center">
    <img
      class="avatar"
      src="https://ui-avatars.com/api/?name={{ user.get_full_name|default:user.username }}&background=2563eb&color=fff"
      alt="Avatar"
    >

    <div class="user-name">
      {{ user.get_full_name|default:user.username }}
    </div>

    <div class="user-position">
      {{ user.position_title|default:"No position title" }}
    </div>
  </div>

  <hr>

  <!-- ORG STRUCTURE -->
  <div class="user-org">
    <div><strong>Section:</strong> {{ user.section.name|default:"—" }}</div>
    <div><strong>Service:</strong> {{ user.service.name|default:"—" }}</div>
    <div><strong>Unit:</strong> {{ user.unit.name|default:"—" }}</div>
  </div>

  <hr>

  <!-- PERSONAL DETAILS -->
  <div class="user-details">
    <div><strong>Username:</strong> {{ user.username }}</div>
    <div><strong>Email:</strong> {{ user.email|default:"—" }}</div>

    <div>
      <strong>Status:</strong>
      {% if user.is_active %}
        <span class="status active">Active</span>
      {% else %}
        <span class="status inactive">Inactive</span>
      {% endif %}
    </div>

    <div><strong>Joined:</strong> {{ user.date_joined|date:"M d, Y" }}</div>
    <div><strong>Last Login:</strong>
      {{ user.last_login|date:"M d, Y · H:i"|default:"Never" }}
    </div>
  </div>

</div>

{% endfor %}


</div>
{% include "admin/page/modals/create_user_modal.html" %}
<!-- =========================
     STYLES
========================= -->
<style>

/* HEADER */
.users-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:.75rem;
}

.user-count{
  background:#eef2ff;
  color:#4338ca;
  font-size:.75rem;
  padding:.15rem .5rem;
  border-radius:999px;
  margin-left:.35rem;
  vertical-align:middle;
}

.btn-add-user{
  background:#2563eb;
  color:#fff;
  padding:.45rem .85rem;
  border-radius:6px;
  font-size:.85rem;
  text-decoration:none;
}

.btn-add-user:hover{
  background:#1e40af;
}


/* FILTER BAR */
.user-filters{
  display:flex;
  gap:.5rem;
  flex-wrap:wrap;
  margin-top:.75rem;
}

.filter-input,
.filter-select{
  padding:.45rem .6rem;
  border:1px solid #e5e7eb;
  border-radius:6px;
  font-size:.85rem;
  background:#f9fafb;
  color:#6b7280;
}

/* GRID */
.user-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:1.25rem;
}

/* CARD */
.user-card{
  position:relative;
  background:#fff;
  border:1px solid #e5e7eb;
  border-radius:10px;
  padding:1.25rem;
}

/* BADGES */
.badge{
  position:absolute;
  font-size:.7rem;
  padding:.25rem .6rem;
  border-radius:999px;
}

.badge-division{
  top:.6rem;
  left:.6rem;
  background:#f3f4f6;
}

.badge-role{
  top:.6rem;
  right:.6rem;
  color:#fff;
}

.badge-role.admin{ background:#dc2626; }
.badge-role.user{ background:#2563eb; }

/* CENTER */
.user-center{
  text-align:center;
  margin-top:1rem;
}

.avatar{
  width:80px;
  height:80px;
  border-radius:50%;
  margin-bottom:.5rem;
}

.user-name{
  font-weight:600;
}

.user-position{
  font-size:.85rem;
  color:#6b7280;
}

/* META */
.user-org,
.user-details{
  font-size:.8rem;
  color:#374151;
}

.status.active{ color:#16a34a; }
.status.inactive{ color:#dc2626; }
</style>

{% endblock %}
