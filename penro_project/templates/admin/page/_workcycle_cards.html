{% if workcycles %}

<section class="wc-grid" aria-label="Work cycle list">

  {% for wc in workcycles %}
  <article class="wc-card" tabindex="0">

    <!-- ================= CARD HEADER ================= -->
    <header class="wc-card-header">

      <section class="wc-card-header-main">

        <!-- TOP ROW: Lifecycle State + Active Badge -->
        <div class="wc-header-top-row">

          <span class="wc-card-section-title lifecycle-{{ wc.lifecycle_state }}">
            {% if wc.lifecycle_state == 'ongoing' %}
              <i class="fas fa-sync-alt"></i>
            {% elif wc.lifecycle_state == 'due_soon' %}
              <i class="fas fa-hourglass-half"></i>
            {% elif wc.lifecycle_state == 'lapsed' %}
              <i class="fas fa-exclamation-triangle"></i>
            {% endif %}
            {{ wc.lifecycle_state|upper }}
          </span>

          <span class="wc-badge {% if wc.is_active %}wc-badge-active{% else %}wc-badge-inactive{% endif %}">
            {% if wc.is_active %}
              <i class="fas fa-check-circle"></i> Active
            {% else %}
              <i class="fas fa-times-circle"></i> Inactive
            {% endif %}
          </span>

        </div>

        <h2 class="wc-card-title">
          {{ wc.title }}
        </h2>

      </section>

      <!-- ACTION MENU -->
      <aside class="wc-card-actions">
        <div class="dropdown">

          <button class="wc-action-menu-btn" data-bs-toggle="dropdown">
            <i class="fas fa-ellipsis-v"></i>
          </button>

          <ul class="dropdown-menu wc-dropdown-menu">

            <li>
              <a class="wc-dropdown-item"
                 href="{% url 'admin_app:workcycle-assignments' wc.id %}">
                <i class="fas fa-eye"></i> View
              </a>
            </li>

            <li>
              <form method="post"
                    action="{% url 'admin_app:workcycle-archive' wc.id %}">
                {% csrf_token %}
                <button type="submit" class="wc-dropdown-item">
                  {% if wc.is_active %}
                    <i class="fas fa-archive"></i> Archive
                  {% else %}
                    <i class="fas fa-box-open"></i> Unarchive
                  {% endif %}
                </button>
              </form>
            </li>

            <li>
              <button type="button"
                      class="wc-dropdown-item"
                      data-bs-toggle="modal"
                      data-bs-target="#reassignWorkcycleModal"
                      data-id="{{ wc.id }}"
                      data-title="{{ wc.title|escapejs }}">
                <i class="fas fa-random"></i> Reassign
              </button>
            </li>

            <li>
              <button type="button"
                      class="wc-dropdown-item"
                      data-bs-toggle="modal"
                      data-bs-target="#editWorkcycleModal"
                      data-id="{{ wc.id }}"
                      data-title="{{ wc.title|escapejs }}"
                      data-description="{{ wc.description|default:''|escapejs }}"
                      data-due="{{ wc.due_at|date:'Y-m-d\\TH:i' }}">
                <i class="fas fa-edit"></i> Edit
              </button>
            </li>

            <li>
              <button class="wc-dropdown-item wc-dropdown-item-danger"
                      data-bs-toggle="modal"
                      data-bs-target="#deleteWorkcycleModal"
                      data-delete-url="{% url 'admin_app:workcycle-delete' wc.id %}">
                <i class="fas fa-trash"></i> Delete
              </button>
            </li>

          </ul>
        </div>
      </aside>

    </header>

    <!-- ================= CARD BODY ================= -->
    <section class="wc-card-body">

      <!-- DEADLINE + TIME LEFT -->
      <div class="wc-deadline-time-row">

        <article class="wc-due-date lifecycle-{{ wc.lifecycle_state }}">
          <header class="wc-due-date-header">
            <span class="wc-due-date-label">
              <i class="fas fa-clock"></i> Deadline
            </span>
          </header>

          <time class="wc-due-date-value">
            {{ wc.due_at|date:"l, F d, Y Â· h:i A" }}
          </time>
        </article>

        <article class="wc-time-remaining">
          <span class="wc-time-remaining-label">
            <i class="fas fa-hourglass-half"></i> Time Left
          </span>
          <strong class="wc-time-remaining-value">
            {{ wc.time_remaining }}
          </strong>
        </article>

      </div>

      {% if wc.description %}
      <article class="wc-description">
        <header class="wc-description-header">
          <i class="fas fa-align-left"></i> Description
        </header>
        <p class="wc-description-text">
          {{ wc.description|truncatechars:50 }}
        </p>
      </article>
      {% endif %}

      <!-- META GRID -->
      <footer class="wc-meta-grid">

        <section class="wc-meta-item">
          <span class="wc-meta-label">
            <i class="fas fa-user"></i> Created By
          </span>
          <span class="wc-meta-value">
            {{ wc.created_by|default:"System" }}
          </span>
        </section>

        <section class="wc-meta-item">
          <span class="wc-meta-label">
            <i class="fas fa-calendar"></i> Created On
          </span>
          <time class="wc-meta-value">
            {{ wc.created_at|date:"M d, Y" }}
          </time>
        </section>

        <section class="wc-meta-item">
          <span class="wc-meta-label">
            <i class="fas fa-tasks"></i> Assignments
          </span>
          <span class="wc-meta-value">
            {{ wc.assignment_count|default:"0" }}
          </span>
        </section>

      </footer>

    </section>

  </article>
  {% endfor %}

</section>

{% else %}

<section class="wc-empty-state">
  <i class="fas fa-inbox fa-3x"
     style="color: var(--text-light); margin-bottom: 1rem;"></i>
  <h2>No Work Cycles Found</h2>
  <p>Create your first work cycle to get started.</p>
</section>

{% endif %}
