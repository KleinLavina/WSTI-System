{% extends "admin/layout/base.html" %}
{% block title %}Work Cycles{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="mb-0 fw-bold">
      <i class="fas fa-layer-group me-2 text-primary"></i>
      Work Cycles
    </h3>
    <small class="text-muted">Manage active and archived work cycles</small>
  </div>

  <button class="btn btn-success shadow-sm"
          data-bs-toggle="modal"
          data-bs-target="#createWorkcycleModal">
    <i class="fas fa-plus me-1"></i>
    Add Work Cycle
  </button>
</div>

{% if workcycles %}
<div class="row g-4">

  {% for wc in workcycles %}
  <div class="col-md-6 col-xl-4">
    <div class="card h-100 workcycle-card position-relative">

      <div class="card-body d-flex flex-column">

        <!-- Header -->
        <div class="mb-2">
          <span class="card-label">
            <i class="fas fa-clipboard-list me-1"></i>
            Work Cycle
          </span>

          <h5 class="fw-semibold mb-1 text-truncate">
            {{ wc.title }}
          </h5>

          {% if wc.is_active %}
            <span class="status-badge active">
              <i class="fas fa-check-circle me-1"></i> Active
            </span>
          {% else %}
            <span class="status-badge archived">
              <i class="fas fa-archive me-1"></i> Archived
            </span>
          {% endif %}
        </div>

        <!-- Actions -->
        <div class="card-actions-absolute">
          <div class="dropdown">
            <button class="btn btn-sm btn-icon action-btn-bg"
                    type="button"
                    data-bs-toggle="dropdown">
              <i class="fas fa-ellipsis-v"></i>
            </button>

            <ul class="dropdown-menu dropdown-menu-end shadow-sm">
              <li>
                <a class="dropdown-item"
                   href="{% url 'admin_app:workcycle-assignments' wc.id %}">
                  <i class="far fa-eye me-2"></i> View Details
                </a>
              </li>

              <li>
                <button type="button"
                        class="dropdown-item"
                        data-bs-toggle="modal"
                        data-bs-target="#editWorkcycleModal"
                        data-id="{{ wc.id }}"
                        data-title="{{ wc.title|escapejs }}"
                        data-description="{{ wc.description|default:''|escapejs }}"
                        data-due="{{ wc.due_at|date:'Y-m-d H:i' }}">
                  <i class="far fa-edit me-2"></i> Edit
                </button>
              </li>

              <li>
                <a class="dropdown-item"
                   href="#"
                   data-bs-toggle="modal"
                   data-bs-target="#reassignWorkcycleModal"
                   data-id="{{ wc.id }}">
                  <i class="fas fa-random me-2"></i> Reassign
                </a>
              </li>

              <li><hr class="dropdown-divider"></li>

              <li>
                <a class="dropdown-item text-danger" href="#">
                  <i class="far fa-trash-alt me-2"></i> Delete
                </a>
              </li>
            </ul>
          </div>
        </div>

        <!-- Description -->
        <div class="mt-3">
          <span class="card-label">
            <i class="far fa-file-alt me-1"></i>
            Description
          </span>

          {% if wc.description %}
          <p class="small text-muted description-clamp mb-0">
            {{ wc.description }}
          </p>
          {% else %}
          <p class="small text-muted fst-italic mb-0">
            No description provided
          </p>
          {% endif %}
        </div>

        <!-- Meta -->
        <div class="mt-auto pt-3 border-top meta-section">
          <div class="meta-item">
            <span class="meta-label">Due Date</span>
            <span class="meta-value">
              <i class="far fa-calendar-alt"></i>
              {{ wc.due_at|date:"M d, Y Â· H:i" }}
            </span>
          </div>

          <div class="meta-item mt-2">
            <span class="meta-label">Created By</span>
            <span class="meta-value">
              <i class="far fa-user"></i>
              {{ wc.created_by|default:"System" }}
            </span>
          </div>
        </div>

      </div>
    </div>
  </div>
  {% endfor %}

</div>
{% else %}
<div class="card shadow-sm">
  <div class="card-body text-center text-muted py-5">
    <i class="fas fa-folder-open fa-2x mb-3"></i>
    <p class="mb-0">No work cycles yet.</p>
  </div>
</div>
{% endif %}

{% include "admin/page/modals/create_workcycle_modal.html" %}
{% include "admin/page/modals/edit_workcycle_modal.html" %}
{% include "admin/page/modals/reassign_workcycle_modal.html" %}

<style>

/* ===== Bright, Clean Surface ===== */
.workcycle-card {
  background: #ffffff;
  border-radius: 16px;
  border: 1px solid rgba(0,0,0,0.04);
  box-shadow:
    0 6px 18px rgba(0,0,0,0.06),
    0 2px 6px rgba(0,0,0,0.04);
  transition: transform .2s ease, box-shadow .2s ease;
}

.workcycle-card:hover {
  transform: translateY(-4px);
  box-shadow:
    0 18px 40px rgba(0,0,0,0.12),
    0 6px 16px rgba(0,0,0,0.08);
}

/* Labels */
.card-label {
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: .06em;
  text-transform: uppercase;
  color: #8b8f97;
  margin-bottom: 4px;
}

/* Status */
.status-badge {
  font-size: .7rem;
  font-weight: 600;
  padding: 4px 10px;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.status-badge.active {
  background: rgba(25,135,84,.14);
  color: #198754;
}

.status-badge.archived {
  background: rgba(108,117,125,.16);
  color: #6c757d;
}

/* Meta */
.meta-section {
  font-size: .8rem;
  color: #6c757d;
}

.meta-label {
  font-size: .65rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: .05em;
  color: #9aa0a6;
}

.meta-value {
  display: flex;
  align-items: center;
  gap: 6px;
}

/* Clamp */
.description-clamp {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  line-clamp: 3;  
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Actions */
.card-actions-absolute {
  position: absolute;
  top: 12px;
  right: 12px;
}

.btn-icon {
  width: 34px;
  height: 34px;
  border-radius: 10px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.action-btn-bg {
  background: #ffffff;
  border: 1px solid rgba(0,0,0,0.06);
  box-shadow: 0 4px 14px rgba(0,0,0,0.1);
}

.action-btn-bg:hover {
  background: #f8f9fa;
}

</style>

{% endblock %}
