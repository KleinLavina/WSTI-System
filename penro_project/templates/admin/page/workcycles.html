{% extends "admin/layout/base.html" %}
{% load static %}

{% block title %}Work Cycles{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/admin/01.css' %}">
  <script src="{% static 'js/base.js' %}"></script>
<!-- =========================
     HEADER BAR (COMPACT)
========================= -->
<div class="wc-unified-header">

  <!-- TOP ROW: Title + Action Buttons -->
  <div class="wc-header-top">
    <div class="wc-title-section">
      <h3 class="wc-main-title">
        <i class="fas fa-layer-group"></i>
        Work Cycles
      </h3>
      <p class="wc-subtitle">
    Delegating tasks and establishing accountability through fixed deadlines for designated personnel.
      </p>
    </div>

    <!-- ACTION BUTTONS (RIGHT SIDE) -->
    <div class="wc-action-buttons-top">
      <button
        type="button"
        class="wc-info-btn"
        data-bs-toggle="modal"
        data-bs-target="#workcyclePurposeModal">
        <i class="fas fa-info-circle"></i>
        What is a Work Cycle?
      </button>

      <a
        href="{% url 'admin_app:inactive-workcycles' %}"
        class="wc-archive-btn">
        <i class="fas fa-archive"></i>
        Archived
      </a>

      <button
        type="button"
        class="wc-create-btn"
        data-bs-toggle="modal"
        data-bs-target="#createWorkcycleModal">
        <i class="fas fa-plus"></i>
        Create New
      </button>
    </div>
  </div>

  <!-- BOTTOM ROW: Filter + Search + Sort (HORIZONTAL) -->
  <div class="wc-header-bottom">

    <!-- FILTERS (LEFT) -->
    <div class="wc-filters-section">
      <span class="wc-section-label">
        <i class="fas fa-filter"></i>
        Filter
      </span>
      <div class="wc-filters">
        <a href="{% url 'admin_app:workcycles' %}"
           class="wc-filter-btn {% if not current_state %}active{% endif %}">
          <span>All Active</span>
          <span class="wc-filter-count">{{ active_count }}</span>
        </a>

        <a href="?state=ongoing"
           class="wc-filter-btn wc-filter-ongoing {% if current_state == 'ongoing' %}active{% endif %}">
          <span>Ongoing</span>
          <span class="wc-filter-count">{{ lifecycle_counts.ongoing }}</span>
        </a>

        <a href="?state=due_soon"
           class="wc-filter-btn wc-filter-due-soon {% if current_state == 'due_soon' %}active{% endif %}">
          <span>Due Soon</span>
          <span class="wc-filter-count">{{ lifecycle_counts.due_soon }}</span>
        </a>

        <a href="?state=lapsed"
           class="wc-filter-btn wc-filter-lapsed {% if current_state == 'lapsed' %}active{% endif %}">
          <span>Lapsed</span>
          <span class="wc-filter-count">{{ lifecycle_counts.lapsed }}</span>
        </a>
      </div>
    </div>

    <!-- SEARCH & SORT (RIGHT) -->
    <div class="wc-search-sort-section">

      <!-- SEARCH -->
      <form method="get" class="wc-search-form">
        {% if current_state %}
          <input type="hidden" name="state" value="{{ current_state }}">
        {% endif %}
        {% if current_sort %}
          <input type="hidden" name="sort" value="{{ current_sort }}">
        {% endif %}

        <div class="wc-search-wrapper">
          <i class="fas fa-search wc-search-icon"></i>
          <input type="search"
                 name="q"
                 value="{{ search_query }}"
                 class="wc-search-input"
                 placeholder="Search work cyclesâ€¦">
          <button type="submit" class="wc-search-btn">
            Search
          </button>
        </div>
      </form>

      <!-- SORT -->
      <div class="wc-sort-wrapper">
        <span class="wc-sort-label">
          <i class="fas fa-sort-amount-down"></i>
          Sort by due
        </span>
        <div class="wc-sort-buttons">
          <a href="?sort=due_asc{% if current_state %}&state={{ current_state }}{% endif %}"
             class="wc-sort-btn {% if current_sort == 'due_asc' %}active{% endif %}">
            <i class="fas fa-arrow-up"></i>
            <span>Asc</span>
          </a>
          <a href="?sort=due_desc{% if current_state %}&state={{ current_state }}{% endif %}"
             class="wc-sort-btn {% if current_sort == 'due_desc' %}active{% endif %}">
            <i class="fas fa-arrow-down"></i>
            <span>Desc</span>
          </a>
        </div>
      </div>

    </div>

  </div>
</div>

<!-- =========================
     CONTENT (CARDS)
========================= -->
<section class="wc-content-area">
  {% include "admin/page/_workcycle_cards.html" %}
</section>

<!-- =========================
     MODALS
========================= -->
{% include "admin/page/modals/workcycle_purpose_modal.html" %}
{% include "admin/page/modals/create_workcycle_modal.html" %}
{% include "admin/page/modals/edit_workcycle_modal.html" %}
{% include "admin/page/modals/delete_workcycles_modal.html" %}
{% include "admin/page/modals/reassign_workcycle_modal.html" %}


{% endblock %}