{% extends "admin/layout/base.html" %}
{% block title %}Assignments — {{ workcycle.title }}{% endblock %}

{% block content %}

<!-- PAGE HEADER -->
<div class="mb-4 d-flex justify-content-between align-items-start flex-wrap gap-3">

  <div>
    <h3 class="mb-1 d-flex align-items-center gap-2">
      <i class="fas fa-tasks text-primary"></i>
      {{ workcycle.title }}
    </h3>

    <div class="text-muted small d-flex align-items-center gap-3 mt-1">
      <span>
        <i class="far fa-calendar-alt me-1"></i>
        Due {{ workcycle.due_at|date:"M d, Y · H:i" }}
      </span>
    </div>

    {% if workcycle.description %}
    <div class="mt-2 text-muted">
      <i class="fas fa-align-left me-1"></i>
      {{ workcycle.description }}
    </div>
    {% endif %}
  </div>

  <!-- RETURN BUTTON -->
  <div>
    <a href="{% url 'admin_app:workcycles' %}"
       class="btn btn-outline-secondary">
      <i class="fas fa-arrow-left me-1"></i>
      Back to Work Cycles
    </a>
  </div>

</div>


<!-- ASSIGNMENT INTENT -->
<div class="card mb-4 shadow-sm">
  <div class="card-header fw-semibold d-flex align-items-center gap-2">
    <i class="fas fa-user-check text-success"></i>
    Assigned To
  </div>

  <div class="card-body">
    {% if assignments %}
      <div class="d-flex flex-wrap gap-2">
        {% for a in assignments %}
          {% if a.assigned_user %}
            <span class="badge rounded-pill bg-primary-subtle text-primary px-3 py-2">
              <i class="far fa-user me-1"></i>
              {{ a.assigned_user.get_full_name|default:a.assigned_user.username }}
            </span>
          {% elif a.assigned_team %}
            <span class="badge rounded-pill bg-success-subtle text-success px-3 py-2">
              <i class="fas fa-users me-1"></i>
              {{ a.assigned_team.name }}
            </span>
          {% endif %}
        {% endfor %}
      </div>
    {% else %}
      <span class="text-muted fst-italic">
        <i class="far fa-circle me-1"></i> No assignments
      </span>
    {% endif %}
  </div>
</div>

<!-- ACTIVE WORK -->
<div class="card mb-4 shadow-sm">
  <div class="card-header fw-semibold d-flex align-items-center gap-2">
    <i class="fas fa-play-circle text-primary"></i>
    Active Work Items
  </div>

  <div class="card-body p-0">
    {% if active_items %}
    <table class="table table-hover mb-0 align-middle">
      <thead class="table-light">
        <tr>
          <th>User</th>
          <th>Status</th>
          <th>Review</th>
          <th>Submitted</th>
        </tr>
      </thead>
      <tbody>
        {% for item in active_items %}
        <tr>
          <td>
            <i class="far fa-user me-1 text-muted"></i>
            {{ item.owner.get_full_name|default:item.owner.username }}
          </td>
          <td>
            <span class="badge bg-secondary-subtle text-secondary">
              {{ item.get_status_display }}
            </span>
          </td>
          <td>
            <span class="badge bg-info-subtle text-info">
              {{ item.get_review_decision_display }}
            </span>
          </td>
          <td>
            {% if item.submitted_at %}
              <i class="far fa-clock me-1 text-muted"></i>
              {{ item.submitted_at|date:"M d, Y · H:i" }}
            {% else %}
              —
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
      <div class="p-3 text-muted fst-italic">
        <i class="far fa-folder-open me-1"></i>
        No active work
      </div>
    {% endif %}
  </div>
</div>

<!-- ARCHIVED WORK -->
<div class="card border-secondary shadow-sm">
  <div class="card-header fw-semibold text-secondary d-flex align-items-center gap-2">
    <i class="fas fa-archive"></i>
    Archived (Reassigned)
  </div>

  <div class="card-body p-0">
    {% if archived_items %}
    <table class="table table-hover mb-0 align-middle">
      <thead class="table-light">
        <tr>
          <th>User</th>
          <th>Last Status</th>
        </tr>
      </thead>
      <tbody>
        {% for item in archived_items %}
        <tr class="text-muted">
          <td>
            <i class="far fa-user me-1"></i>
            {{ item.owner.get_full_name|default:item.owner.username }}
          </td>
          <td>
            {{ item.get_status_display }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
      <div class="p-3 text-muted fst-italic">
        <i class="fas fa-box-open me-1"></i>
        No archived work
      </div>
    {% endif %}
  </div>
</div>

{% endblock %}
