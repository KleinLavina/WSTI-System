<style>
/* ===========================
   COLOR PALETTE - SOFT MUTED DARK BLUE
=========================== */
:root {
  --dark-blue-50: #f8fafc;
  --dark-blue-100: #f1f5f9;
  --dark-blue-200: #e2e8f0;
  --dark-blue-300: #cbd5e1;
  --dark-blue-400: #94a3b8;
  --dark-blue-500: #64748b;
  --dark-blue-600: #475569;
  --dark-blue-700: #334155;
  --dark-blue-800: #1e293b;
  --dark-blue-900: #0f172a;
  
  --accent-blue-soft: #3b82f6;
  --accent-blue-muted: #60a5fa;
  --accent-teal: #0d9488;
}

/* ===========================
   USER GRID - ENHANCED COMPACT
=========================== */
.user-grid-compact {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 0.875rem;
  padding: 0.5rem 0;
  background: var(--dark-blue-50);
}

.user-card-compact {
  background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
  border: 1px solid var(--dark-blue-200);
  border-radius: 10px;
  padding: 0.875rem;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
  position: relative;
  min-height: 210px;
  overflow: hidden;
}

.user-card-compact::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-blue-soft), var(--accent-teal));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.user-card-compact:hover {
  transform: translateY(-4px) scale(1.01);
  box-shadow: 0 20px 25px -5px rgba(30, 41, 59, 0.1), 0 10px 10px -5px rgba(30, 41, 59, 0.04);
  border-color: var(--accent-blue-muted);
}

.user-card-compact:hover::before {
  opacity: 1;
}

/* BADGES WITH CONTEXT */
.badges-context {
  display: flex;
  justify-content: space-between;
  gap: 0.5rem;
  margin-bottom: 0.375rem;
}

.context-item {
  flex: 1;
  min-width: 0;
}

.context-label {
  font-size: 0.6rem;
  color: var(--dark-blue-500);
  font-weight: 600;
  margin-bottom: 0.25rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: flex;
  align-items: center;
  gap: 0.25rem;
  letter-spacing: 0.02em;
}

.context-label i {
  font-size: 0.6rem;
  color: var(--dark-blue-400);
}

.badge-division-compact,
.badge-role-compact {
  display: block;
  font-size: 0.65rem !important;
  padding: 0.3rem 0.4rem !important;
  border-radius: 6px;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 100%;
  text-align: center;
  transition: all 0.2s ease;
}

.badge.badge-division-compact {
  background: linear-gradient(135deg, #6b8f71 0%, #4f7660 100%);
  color: #ffffff;
  border: none;
  box-shadow: 0 2px 4px rgba(79, 118, 96, 0.25);
}

.badge-role-compact.admin {
  background: linear-gradient(135deg, var(--dark-blue-700) 0%, var(--dark-blue-900) 100%);
  color: white;
  border: none;
  box-shadow: 0 2px 4px rgba(30, 41, 59, 0.2);
}

.badge-role-compact.user {
  background: linear-gradient(135deg, var(--accent-blue-soft) 0%, #1d4ed8 100%);
  color: white;
  border: none;
  box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
}

/* USER PROFILE - COMPACT */
.user-profile-enhanced {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 0.5rem 0;
  border-top: 1px solid var(--dark-blue-100);
  border-bottom: 1px solid var(--dark-blue-100);
}

.avatar-compact {
  width: 48px !important;
  height: 48px !important;
  border-radius: 10px;
  flex-shrink: 0;
  border: 2px solid white;
  box-shadow: 0 4px 12px rgba(30, 41, 59, 0.1), 0 0 0 1px var(--dark-blue-200);
  object-fit: cover;
}

.user-details-compact {
  flex: 1;
  min-width: 0;
}

.detail-group {
  margin-bottom: 0.375rem;
}

.detail-group:last-child {
  margin-bottom: 0;
}

.detail-label {
  font-size: 0.6rem;
  color: var(--dark-blue-500);
  font-weight: 600;
  margin-bottom: 0.2rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: flex;
  align-items: center;
  gap: 0.25rem;
  letter-spacing: 0.02em;
}

.detail-label i {
  font-size: 0.6rem;
  color: var(--dark-blue-400);
  width: 10px;
  text-align: center;
}

.user-name-compact {
  font-weight: 700;
  font-size: 0.85rem;
  color: var(--dark-blue-900);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.3;
  letter-spacing: -0.01em;
}

.user-position-compact {
  font-size: 0.725rem;
  color: var(--dark-blue-700);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.3;
  font-weight: 500;
}

/* ORGANIZATIONAL STRUCTURE */
.org-structure-compact {
  background: linear-gradient(135deg, var(--dark-blue-50) 0%, #ffffff 100%);
  border-radius: 8px;
  padding: 0.5rem;
  margin: 0.25rem 0 0.375rem 0;
  border: 1px solid var(--dark-blue-200);
  position: relative;
}

.org-structure-compact::before {
  content: '';
  position: absolute;
  left: 0.75rem;
  top: 0;
  bottom: 0;
  width: 2px;
  background: linear-gradient(to bottom, var(--accent-blue-muted), var(--accent-teal));
  border-radius: 1px;
}

.org-level {
  display: flex;
  align-items: center;
  margin-bottom: 0.375rem;
  position: relative;
  padding-left: 1.25rem;
}

.org-level:last-child {
  margin-bottom: 0;
}

.org-level::before {
  content: '';
  position: absolute;
  left: 0;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--accent-blue-soft);
  border: 2px solid white;
  box-shadow: 0 0 0 1px var(--dark-blue-300);
}

.level-label {
  font-size: 0.6rem;
  color: var(--dark-blue-600);
  font-weight: 600;
  flex-shrink: 0;
  width: 55px;
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.level-label i {
  font-size: 0.6rem;
  flex-shrink: 0;
  color: var(--dark-blue-500);
}

.level-value {
  font-size: 0.675rem;
  color: var(--dark-blue-800);
  font-weight: 500;
  text-align: left;
  flex: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding: 0.3rem 0.6rem;
  background: white;
  border-radius: 5px;
  border: 1px solid var(--dark-blue-200);
  margin-left: 0.5rem;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

/* STATUS SECTION */
.status-section {
  min-width: 0;
  padding-top: 0.375rem;
  border-top: 1px solid var(--dark-blue-100);
}

.status-label {
  font-size: 0.6rem;
  color: var(--dark-blue-500);
  font-weight: 600;
  margin-bottom: 0.3rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: flex;
  align-items: center;
  gap: 0.25rem;
  letter-spacing: 0.02em;
}

.status-label i {
  font-size: 0.6rem;
  color: var(--dark-blue-400);
}

.status-badge {
  font-size: 0.65rem;
  padding: 0.3rem 0.4rem;
  border-radius: 6px;
  font-weight: 600;
  white-space: nowrap;
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  width: 100%;
  text-align: center;
  justify-content: center;
  border: 1px solid transparent;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.status-badge.active {
  background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
  color: #065f46;
  border-color: #a7f3d0;
}

.status-badge.inactive {
  background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
  color: #991b1b;
  border-color: #fecaca;
}

.status-icon {
  font-size: 0.5rem;
  display: inline-block;
}

/* QUICK ACTION BUTTON */
.card-actions {
  margin-top: auto;
  padding-top: 0.375rem;
  border-top: 1px solid var(--dark-blue-100);
}

.btn-view-details {
  width: 100%;
  background: linear-gradient(135deg, white 0%, var(--dark-blue-50) 100%);
  color: var(--dark-blue-700);
  border: 1px solid var(--dark-blue-300);
  padding: 0.5rem;
  border-radius: 6px;
  font-size: 0.725rem;
  text-decoration: none;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.25s ease;
  white-space: nowrap;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
  letter-spacing: 0.02em;
}

.btn-view-details:hover {
  background: linear-gradient(135deg, var(--dark-blue-50) 0%, var(--dark-blue-100) 100%);
  color: var(--accent-blue-soft);
  border-color: var(--accent-blue-muted);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
}

.btn-view-details i {
  font-size: 0.725rem;
  transition: transform 0.2s ease;
}

.btn-view-details:hover i {
  transform: translateX(2px);
}

/* ===========================
   RESPONSIVE GRID
=========================== */
@media (max-width: 1400px) {
  .user-grid-compact {
    grid-template-columns: repeat(5, 1fr);
  }
}

@media (max-width: 1100px) {
  .user-grid-compact {
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }
  
  .user-card-compact {
    padding: 1rem;
  }
}

@media (max-width: 900px) {
  .user-grid-compact {
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }
  
  .user-card-compact {
    padding: 1.125rem;
  }
}

@media (max-width: 768px) {
  .user-grid-compact {
    grid-template-columns: repeat(2, 1fr);
    gap: 1.25rem;
  }
  
  .user-card-compact {
    padding: 1.25rem;
  }
  
  .user-profile-enhanced {
    gap: 1rem;
  }
  
  .avatar-compact {
    width: 56px !important;
    height: 56px !important;
  }
}

@media (max-width: 480px) {
  .user-grid-compact {
    grid-template-columns: 1fr;
  }
  
  .user-card-compact {
    padding: 1rem;
  }
  
  .badges-context {
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .org-structure-compact {
    padding: 0.875rem;
  }
  
  .org-level {
    padding-left: 1.5rem;
  }
}
</style>

<!-- =========================
     USER GRID - ENHANCED COMPACT
========================= -->
<div class="user-grid-compact">
  {% for user in users %}
  <div class="user-card-compact">

    <!-- BADGES WITH CONTEXT -->
    <div class="badges-context">
      <div class="context-item">
        <div class="context-label">
          <i class="fas fa-building"></i> Division
        </div>
        <span class="badge badge-division-compact" title="Division: {{ user.org_assignment.division.name|default:'No Division' }}">
          {{ user.org_assignment.division.name|default:"—"|truncatechars:14 }}
        </span>
      </div>
      <div class="context-item">
        <div class="context-label">
          <i class="fas fa-user-tag"></i> Role
        </div>
        <span class="badge badge-role-compact {% if user.login_role == 'admin' %}admin{% else %}user{% endif %}" 
              title="User Role: {{ user.get_login_role_display }}">
          {{ user.get_login_role_display|truncatechars:12 }}
        </span>
      </div>
    </div>

    <!-- USER PROFILE WITH DETAILS -->
    <div class="user-profile-enhanced">
      {% if user.profile_image %}
        <img class="avatar-compact"
             src="{{ user.profile_image.url }}"
             alt="{{ user.get_full_name|default:user.username }}"
             title="User Avatar">
      {% else %}
        <img class="avatar-compact"
             src="https://ui-avatars.com/api/?name={{ user.get_full_name|default:user.username }}&background=3b82f6&color=fff&size=48&bold=true"
             alt="{{ user.get_full_name|default:user.username }}"
             title="User Avatar">
      {% endif %}
      
      <div class="user-details-compact">
        <div class="detail-group">
          <div class="detail-label">
            <i class="fas fa-user"></i> Name
          </div>
          <div class="user-name-compact" title="{{ user.get_full_name|default:user.username }}">
            {{ user.get_full_name|default:user.username|truncatechars:20 }}
          </div>
        </div>
        
        <div class="detail-group">
          <div class="detail-label">
            <i class="fas fa-briefcase"></i> Position
          </div>
          <div class="user-position-compact" title="{{ user.position_title|default:'No position title' }}">
            {{ user.position_title|default:"No title"|truncatechars:22 }}
          </div>
        </div>
      </div>
    </div>

    <!-- ORGANIZATIONAL STRUCTURE VISUAL -->
    <div class="org-structure-compact">
      <div class="org-level">
        <div class="level-label">
          <i class="fas fa-layer-group"></i> Section
        </div>
        <div class="level-value" title="Section: {{ user.org_assignment.section.name|default:'Not assigned' }}">
          {{ user.org_assignment.section.name|default:"—"|truncatechars:25 }}
        </div>
      </div>
      
      <div class="org-level">
        <div class="level-label">
          <i class="fas fa-sitemap"></i> Service
        </div>
        <div class="level-value" title="Service: {{ user.org_assignment.service.name|default:'Not assigned' }}">
          {{ user.org_assignment.service.name|default:"—"|truncatechars:25 }}
        </div>
      </div>
      
      <div class="org-level">
        <div class="level-label">
          <i class="fas fa-users"></i> Unit
        </div>
        <div class="level-value" title="Unit: {{ user.org_assignment.unit.name|default:'Not assigned' }}">
          {{ user.org_assignment.unit.name|default:"—"|truncatechars:25 }}
        </div>
      </div>
    </div>

    <!-- STATUS -->
    <div class="status-section">
      <div class="status-label">
        <i class="fas fa-circle-check"></i> Status
      </div>
      <div class="status-badge {% if user.is_active %}active{% else %}inactive{% endif %}" 
           title="Account is {% if user.is_active %}active{% else %}inactive{% endif %}">
        {% if user.is_active %}
          <i class="fas fa-circle status-icon"></i> Active
        {% else %}
          <i class="fas fa-circle status-icon"></i> Inactive
        {% endif %}
      </div>
    </div>

    <!-- QUICK ACTION BUTTON -->
    <div class="card-actions">
      <a href="{% url 'admin_app:user-profile' user.id %}"
         class="btn-view-details"
         title="View full details for {{ user.first_name|default:user.username }}">
        <i class="fas fa-arrow-right"></i>
        View Details
      </a>
    </div>

  </div>
  {% endfor %}
</div>