{% extends "user/layout/base.html" %}
{% block title %}Discussion{% endblock %}
{% block content %}

<div class="work-wrapper">

  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h6 class="fw-semibold mb-0">
      <i class="fas fa-comment-dots text-primary me-1"></i>
      Discussion — {{ work_item.workcycle.title }}
    </h6>

    <a href="{% url 'user_app:work-item-detail' work_item.id %}"
       class="btn btn-sm btn-outline-secondary">
      <i class="fas fa-arrow-left me-1"></i>Back
    </a>
  </div>

  <!-- THREAD -->
  <div class="card">
    <div class="card-body">

      {% if messages %}
        {% for m in messages %}
        <div class="mb-3 pb-2 border-bottom">
          <div class="small fw-semibold">
            {{ m.sender.get_full_name|default:m.sender.username }}
            <span class="text-muted">
              · {{ m.created_at|date:"M d, Y · H:i" }}
            </span>
          </div>
          <div class="small text-muted" style="white-space:pre-line;">
            {{ m.message }}
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="small-muted fst-italic">
          No messages yet. Start the discussion below.
        </div>
      {% endif %}

    </div>
  </div>

  <!-- NEW MESSAGE -->
  <div class="card">
    <div class="card-body">
      <form method="post">
        {% csrf_token %}
        <textarea class="form-control form-control-sm mb-2"
                  name="message"
                  rows="3"
                  placeholder="Write a comment…"></textarea>

        <button class="btn btn-sm btn-primary">
          <i class="fas fa-paper-plane me-1"></i>Post Comment
        </button>
      </form>
    </div>
  </div>

</div>

{% endblock %}
