{% if work_items %}

<section class="wi-grid" aria-label="Work items list">

  {% for item in work_items %}
  <article class="wi-card {% if not item.is_active %}wi-card-inactive{% endif %}" tabindex="0">

    <!-- ================= CARD HEADER ================= -->
    <header class="wi-card-header">

      <!-- STATUS BADGES ROW -->
      <div class="wi-status-row">
        <!-- LIFECYCLE STATE -->
        <span class="wi-lifecycle-badge lifecycle-{{ item.workcycle.lifecycle_state }}">
          {% if item.workcycle.lifecycle_state == 'ongoing' %}
            <i class="fas fa-play-circle"></i>
          {% elif item.workcycle.lifecycle_state == 'due_soon' %}
            <i class="fas fa-clock"></i>
          {% elif item.workcycle.lifecycle_state == 'lapsed' %}
            <i class="fas fa-exclamation-circle"></i>
          {% endif %}
          <span class="wi-badge-text">{{ item.workcycle.lifecycle_state|title }}</span>
        </span>
      </div>

      <!-- TITLE -->
      <div class="wi-title-row">
        <h3 class="wi-card-title">
          <i class="fas fa-folder-open"></i>
          {{ item.workcycle.title }}
        </h3>
      </div>

    </header>

    <!-- ================= CARD BODY ================= -->
    <section class="wi-card-body">

      <!-- WORK & REVIEW STATUS ROW (HORIZONTAL) -->
      <div class="wi-status-row-horizontal">
        <!-- WORK STATUS WITH LABEL -->
        <div class="wi-status-section">
          <div class="wi-section-label">
            <i class="fas fa-tasks"></i>
            Work Status
          </div>
          <span class="wi-work-badge-large status-{{ item.status }}">
            {% if item.status == 'not_started' %}
              <i class="fas fa-pause-circle"></i>
            {% elif item.status == 'working_on_it' %}
              <i class="fas fa-spinner"></i>
            {% else %}
              <i class="fas fa-check-circle"></i>
            {% endif %}
            {{ item.get_status_display }}
          </span>
        </div>

        <!-- REVIEW STATUS WITH LABEL -->
        <div class="wi-status-section">
          <div class="wi-section-label">
            <i class="fas fa-clipboard-check"></i>
            Review Status
          </div>
          <span class="wi-review-badge-large review-{{ item.review_decision }}">
            {% if item.review_decision == 'pending' %}
              <i class="fas fa-hourglass-half"></i>
            {% elif item.review_decision == 'approved' %}
              <i class="fas fa-check-circle"></i>
            {% else %}
              <i class="fas fa-edit"></i>
            {% endif %}
            {{ item.get_review_decision_display }}
          </span>
        </div>
      </div>

      <!-- DEADLINE & COUNTDOWN ROW -->
      <div class="wi-info-row">
        <div class="wi-info-card">
          <div class="wi-info-header">
            <i class="fas fa-calendar-alt"></i>
            <span>Due Date</span>
          </div>
          <div class="wi-info-content">
            <time class="wi-info-date">
              {{ item.workcycle.due_at|date:"M d, Y" }}
            </time>
            <span class="wi-info-time">
              {{ item.workcycle.due_at|date:"h:i A" }}
            </span>
          </div>
        </div>

        {% if item.is_active %}
        <div class="wi-countdown-card">
        <div class="wi-info-header">
            <i class="fas fa-hourglass-half"></i>
            <span>Time Remaining</span>
        </div>
        <div class="wi-countdown-content lifecycle-{{ item.workcycle.lifecycle_state }}">
            {{ item.time_remaining }}
        </div>
        </div>
        {% endif %}

      </div>

    </section>

    <!-- ================= CARD FOOTER ================= -->
    <footer class="wi-card-footer">
      {% if item.is_active %}
        <a href="{% url 'user_app:work-item-detail' item.id %}" 
           class="wi-action-btn status-{{ item.status }}">
          {% if item.status == 'done' %}
            <i class="fas fa-check-double"></i>
            <span>Check Item</span>
          {% else %}
            <i class="fas fa-arrow-right"></i>
            <span>Open Work Item</span>
          {% endif %}
        </a>
      {% else %}
        <div class="wi-inactive-notice">
          <i class="fas fa-archive"></i>
          <span>Archived</span>
        </div>
      {% endif %}
    </footer>

  </article>
  {% endfor %}

</section>

{% else %}

<section class="wi-empty-state">
  <div class="wi-empty-icon">
    <i class="fas fa-clipboard-list"></i>
  </div>
  <h3 class="wi-empty-title">No Work Items Found</h3>
  <p class="wi-empty-text">
    {% if search_query or active_status or active_review or active_lifecycle %}
      Try adjusting your filters or search query.
    {% else %}
      You don't have any assigned work items yet.
    {% endif %}
  </p>
</section>

{% endif %}

<!-- =========================
     STYLES
========================= -->
<style>
/* =============================
   COLOR PALETTE (MUTED)
============================= */
:root {
  /* Lifecycle Colors */
  --lifecycle-lapsed: #e26666;     /* Muted red */
  --lifecycle-due-soon: #e89a4f;   /* Muted orange */
  --lifecycle-ongoing: #4fa3d1;    /* Muted sky blue */
  
  /* Review Decisions */
  --review-pending: #8b6fd6;       /* Muted violet */
  --review-approved: #3fa38c;      /* Muted teal green */
  --review-revision: #c0545e;      /* Muted crimson */
  
  /* Work Status */
  --status-not-started: #7b8794;   /* Muted slate */
  --status-working: #b7791f;       /* Muted amber/brown */
  --status-done: #6fb34d;          /* Muted green */
}

/* =============================
   CARD GRID
============================= */
.wi-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
  gap: 20px;
  margin-top: 0;
}

/* =============================
   CARD STYLES
============================= */
.wi-card {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 14px;
  box-shadow: 0 3px 12px rgba(15, 23, 42, 0.06);
  transition: all 0.25s ease;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  height: 100%;
}

.wi-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(15, 23, 42, 0.1);
  border-color: #cbd5e1;
}

.wi-card-inactive {
  opacity: 0.7;
  background: #f8fafc;
}

.wi-card:focus-within {
  outline: 2px solid #8b6fd6;
  outline-offset: 2px;
}

/* CARD HEADER */
.wi-card-header {
  padding: 16px 18px 14px;
  border-bottom: 1px solid #f1f5f9;
}

.wi-status-row {
  display: flex;
  gap: 6px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}

.wi-lifecycle-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 3px 8px;
  border-radius: 6px;
  font-size: 0.65rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.02em;
  line-height: 1.2;
}

.wi-badge-text {
  font-size: 0.625rem;
  font-weight: 700;
}

/* Lifecycle States - Muted Colors */
.wi-lifecycle-badge.lifecycle-ongoing {
  background: rgba(79, 163, 209, 0.15);
  color: #2b6b8f;
  border: 1px solid rgba(79, 163, 209, 0.3);
}

.wi-lifecycle-badge.lifecycle-due_soon {
  background: rgba(232, 154, 79, 0.15);
  color: #a16433;
  border: 1px solid rgba(232, 154, 79, 0.3);
}

.wi-lifecycle-badge.lifecycle-lapsed {
  background: rgba(226, 102, 102, 0.15);
  color: #a84444;
  border: 1px solid rgba(226, 102, 102, 0.3);
}

.wi-title-row {
  margin-top: 4px;
}

.wi-card-title {
  font-size: 1rem;
  font-weight: 700;
  color: #1e293b;
  margin: 0;
  line-height: 1.4;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
}

.wi-card-title i {
  color: #64748b;
  margin-right: 6px;
  font-size: 0.9rem;
}

/* CARD BODY */
.wi-card-body {
  padding: 16px 18px;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* HORIZONTAL STATUS ROW */
.wi-status-row-horizontal {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

/* STATUS SECTIONS (WORK & REVIEW) WITH LABELS */
.wi-status-section {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.wi-section-label {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 0.7rem;
  font-weight: 600;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.02em;
}

.wi-section-label i {
  font-size: 0.65rem;
}

/* WORK STATUS BADGE */
.wi-work-badge-large {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 7px 11px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 700;
  text-transform: capitalize;
  border: 1px solid;
  align-self: flex-start;
}

.wi-work-badge-large i {
  font-size: 0.7rem;
}

.wi-work-badge-large.status-not_started {
  background: rgba(123, 135, 148, 0.15);
  color: #4a5563;
  border-color: rgba(123, 135, 148, 0.3);
}

.wi-work-badge-large.status-working_on_it {
  background: rgba(183, 121, 31, 0.15);
  color: #8b5d18;
  border-color: rgba(183, 121, 31, 0.3);
}

.wi-work-badge-large.status-done {
  background: rgba(111, 179, 77, 0.15);
  color: #4a7d35;
  border-color: rgba(111, 179, 77, 0.3);
}

/* REVIEW STATUS BADGE */
.wi-review-badge-large {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 7px 11px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 700;
  text-transform: capitalize;
  border: 1px solid;
  align-self: flex-start;
}

.wi-review-badge-large i {
  font-size: 0.7rem;
}

.wi-review-badge-large.review-pending {
  background: rgba(139, 111, 214, 0.15);
  color: #5c4591;
  border-color: rgba(139, 111, 214, 0.3);
}

.wi-review-badge-large.review-approved {
  background: rgba(63, 163, 140, 0.15);
  color: #2a6f5d;
  border-color: rgba(63, 163, 140, 0.3);
}

.wi-review-badge-large.review-revision {
  background: rgba(192, 84, 94, 0.15);
  color: #8e3d45;
  border-color: rgba(192, 84, 94, 0.3);
}

/* INFO ROW (DUE DATE & COUNTDOWN) */
.wi-info-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  padding: 12px;
  background: #f8fafc;
  border-radius: 10px;
  border: 1px solid #e2e8f0;
  margin-top: 2px;
}

.wi-info-card,
.wi-countdown-card {
  display: flex;
  flex-direction: column;
}

.wi-info-header {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 0.7rem;
  font-weight: 600;
  color: #64748b;
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.02em;
}

.wi-info-header i {
  font-size: 0.65rem;
}

.wi-info-content {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.wi-info-date {
  font-size: 0.875rem;
  font-weight: 700;
  color: #1e293b;
}

.wi-info-time {
  font-size: 0.75rem;
  color: #64748b;
  font-weight: 500;
}

/* COUNTDOWN CONTENT */
.wi-countdown-content {
  font-size: 0.875rem;
  font-weight: 700;
  padding: 6px 10px;
  border-radius: 8px;
  text-align: center;
  border: 1px solid;
  background: #ffffff;
}

.wi-countdown-content.lifecycle-ongoing {
  color: #2b6b8f;
  border-color: rgba(79, 163, 209, 0.3);
  background: rgba(79, 163, 209, 0.1);
}

.wi-countdown-content.lifecycle-due_soon {
  color: #a16433;
  border-color: rgba(232, 154, 79, 0.3);
  background: rgba(232, 154, 79, 0.1);
}

.wi-countdown-content.lifecycle-lapsed {
  color: #a84444;
  border-color: rgba(226, 102, 102, 0.3);
  background: rgba(226, 102, 102, 0.1);
}

/* CARD FOOTER */
.wi-card-footer {
  padding: 14px 18px;
  border-top: 1px solid #f1f5f9;
  background: #f8fafc;
  margin-top: auto;
}

/* ACTION BUTTON - CHANGES COLOR BASED ON STATUS */
.wi-action-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  color: white;
  text-decoration: none;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 600;
  transition: all 0.2s ease;
  width: 100%;
  justify-content: center;
}

.wi-action-btn i {
  font-size: 0.75rem;
}

/* Button colors based on work status */
.wi-action-btn.status-not_started {
  background: var(--status-not-started);
}

.wi-action-btn.status-not_started:hover {
  background: #6a7582;
  transform: translateY(-1px);
  box-shadow: 0 3px 10px rgba(123, 135, 148, 0.3);
  color: white;
}

.wi-action-btn.status-working_on_it {
  background: var(--status-working);
}

.wi-action-btn.status-working_on_it:hover {
  background: #a56b1b;
  transform: translateY(-1px);
  box-shadow: 0 3px 10px rgba(183, 121, 31, 0.3);
  color: white;
}

.wi-action-btn.status-done {
  background: var(--status-done);
}

.wi-action-btn.status-done:hover {
  background: #5fa143;
  transform: translateY(-1px);
  box-shadow: 0 3px 10px rgba(111, 179, 77, 0.3);
  color: white;
}

.wi-inactive-notice {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 8px 14px;
  background: #f1f5f9;
  color: #64748b;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 600;
}

/* EMPTY STATE */
.wi-empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 50px 20px;
  text-align: center;
  background: #ffffff;
  border: 2px dashed #e5e7eb;
  border-radius: 16px;
  margin-top: 0;
}

.wi-empty-icon {
  font-size: 2.5rem;
  color: #cbd5e1;
  margin-bottom: 16px;
}

.wi-empty-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #475569;
  margin-bottom: 6px;
}

.wi-empty-text {
  font-size: 0.875rem;
  font-weight: 400;
  color: #94a3b8;
  margin: 0;
  max-width: 400px;
}

/* RESPONSIVE */
@media (max-width: 1200px) {
  .wi-grid {
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  }
}

@media (max-width: 768px) {
  .wi-grid {
    grid-template-columns: 1fr;
    gap: 16px;
  }
  
  .wi-status-row-horizontal {
    grid-template-columns: 1fr;
    gap: 10px;
  }
  
  .wi-info-row {
    grid-template-columns: 1fr;
    gap: 10px;
  }
  
  .wi-card-header,
  .wi-card-body,
  .wi-card-footer {
    padding: 14px 16px;
  }
}

@media (max-width: 480px) {
  .wi-status-row {
    flex-wrap: wrap;
  }
  
  .wi-card-title {
    font-size: 0.95rem;
  }
  
  .wi-work-badge-large,
  .wi-review-badge-large {
    width: 100%;
    justify-content: center;
  }
}
</style>