{% if work_items %}

<section class="wi-grid" aria-label="Archived work items">

  {% for item in work_items %}
  {% with archive_type=item.inactive_by.login_role|default:"system" %}
  <article class="wi-card wi-card-archived archive-type-{{ archive_type }}" tabindex="0">

    <!-- ================= CARD HEADER ================= -->
    <header class="wi-card-header">
      
      <!-- TITLE -->
      <div class="wi-title-row">
        <h3 class="wi-card-title">
          <i class="fas fa-folder-open"></i>
          {{ item.workcycle.title }}
        </h3>
      </div>

      <!-- ACTION AREA (TOP RIGHT) -->
      <div class="wi-card-actions">
        {% if archive_type == "user" %}
          <!-- User-archived items have 3-dot menu -->
          <div class="wi-card-menu">
            <button class="wi-menu-btn" aria-label="Actions">⋮</button>
            <div class="wi-menu-dropdown">
              <a href="{% url 'user_app:work-item-detail' item.id %}">
                <i class="fas fa-eye"></i> View
              </a>
              <form method="post"
                    action="{% url 'user_app:work-item-toggle-archive' item.id %}">
                {% csrf_token %}
                <button type="submit" class="wi-menu-action">
                  <i class="fas fa-undo"></i> Restore
                </button>
              </form>
            </div>
          </div>
        {% elif archive_type == "admin" and item.inactive_reason %}
          <!-- Admin-archived items have info button showing reason -->
          <button class="wi-reason-btn" 
                  aria-label="View archive reason"
                  data-reason="{{ item.get_inactive_reason_display }}"
                  data-note="{{ item.inactive_note|default:'' }}"
                  data-admin="{{ item.inactive_by.get_full_name|default:item.inactive_by.username }}"
                  data-date="{{ item.inactive_at|date:'M d, Y · h:i A' }}">
            <i class="fas fa-info-circle"></i>
          </button>
        {% endif %}
      </div>

    </header>

    <!-- ================= ARCHIVED INFO BANNER ================= -->
    <div class="wi-archived-banner banner-{{ archive_type }}">
      {% if item.inactive_by %}
        {% if archive_type == "admin" %}
          <!-- ADMIN ARCHIVED -->
          <div class="wi-admin-archived">
            <i class="fas fa-user-shield"></i>
            <div class="wi-archived-details">
              <strong>Archived by Administrator</strong>
              <div class="wi-archived-meta">
                <span class="wi-archived-by">
                  {{ item.inactive_by.get_full_name|default:item.inactive_by.username }}
                </span>
                {% if item.inactive_at %}
                  <span class="wi-archived-date">
                    {{ item.inactive_at|date:"M d, Y · h:i A" }}
                  </span>
                {% endif %}
              </div>
              <!-- Show reason in banner if no button -->
              {% if not item.inactive_reason %}
                {% if item.get_inactive_reason_display %}
                  <div class="wi-archived-reason">
                    <i class="fas fa-info-circle"></i>
                    {{ item.get_inactive_reason_display }}
                  </div>
                {% endif %}
                {% if item.inactive_note %}
                  <div class="wi-archived-note">
                    <i class="fas fa-sticky-note"></i>
                    {{ item.inactive_note }}
                  </div>
                {% endif %}
              {% endif %}
            </div>
          </div>
        {% else %}
          <!-- USER ARCHIVED -->
          <div class="wi-user-archived">
            <i class="fas fa-user"></i>
            <div class="wi-archived-details">
              <strong>Archived by You</strong>
              <div class="wi-archived-meta">
                <span class="wi-archived-date">
                  {{ item.inactive_at|date:"M d, Y · h:i A" }}
                </span>
              </div>
            </div>
          </div>
        {% endif %}
      {% else %}
        <!-- SYSTEM ARCHIVED -->
        <div class="wi-system-archived">
          <i class="fas fa-robot"></i>
          <div class="wi-archived-details">
            <strong>System Archived</strong>
            <div class="wi-archived-meta">
              Auto-archived based on completion rules
            </div>
          </div>
        </div>
      {% endif %}
    </div>

    <!-- ================= CARD BODY ================= -->
    <section class="wi-card-body">

      <!-- ARCHIVE STATUS & REVIEW STATUS ROW -->
      <div class="wi-status-row-horizontal">
        <!-- ARCHIVE STATUS BADGE -->
        <div class="wi-status-section">
          <div class="wi-section-label">
            <i class="fas fa-archive"></i>
            Archive Status
          </div>
          <span class="wi-archive-badge-large archive-{{ archive_type }}">
            {% if archive_type == "admin" %}
              <i class="fas fa-user-shield"></i>
              Admin Archived
            {% elif archive_type == "user" %}
              <i class="fas fa-user"></i>
              Archived by You
            {% else %}
              <i class="fas fa-robot"></i>
              System Archived
            {% endif %}
          </span>
        </div>

        <!-- REVIEW STATUS WITH LABEL -->
        <div class="wi-status-section">
          <div class="wi-section-label">
            <i class="fas fa-clipboard-check"></i>
            Final Review
          </div>
          <span class="wi-review-badge-large review-{{ item.review_decision }}">
            {% if item.review_decision == 'pending' %}
              <i class="fas fa-hourglass-half"></i>
            {% elif item.review_decision == 'approved' %}
              <i class="fas fa-check-circle"></i>
            {% else %}
              <i class="fas fa-edit"></i>
            {% endif %}
            {{ item.get_review_decision_display }}
          </span>
        </div>
      </div>

      <!-- FINAL STATUS & DATE INFO -->
      <div class="wi-info-row">
        <div class="wi-info-card">
          <div class="wi-info-header">
            <i class="fas fa-calendar-alt"></i>
            <span>Original Due Date</span>
          </div>
          <div class="wi-info-content">
            <time class="wi-info-date">
              {{ item.workcycle.due_at|date:"M d, Y" }}
            </time>
            <span class="wi-info-time">
              {{ item.workcycle.due_at|date:"h:i A" }}
            </span>
          </div>
        </div>

        <div class="wi-final-card">
          <div class="wi-info-header">
            <i class="fas fa-flag-checkered"></i>
            <span>Completion</span>
          </div>
          <div class="wi-final-content {% if item.status == 'done' %}status-done{% else %}status-incomplete{% endif %}">
            {% if item.status == 'done' %}
              Completed
            {% else %}
              Incomplete
            {% endif %}
          </div>
        </div>
      </div>

    </section>

    <!-- ================= CARD FOOTER ================= -->
    <footer class="wi-card-footer">
      {% if archive_type == "user" %}
        <!-- User-archived items have action buttons -->
        <div class="wi-footer-actions">
          <a href="{% url 'user_app:work-item-detail' item.id %}" 
             class="wi-action-btn wi-view-btn">
            <i class="fas fa-eye"></i>
            <span>View Details</span>
          </a>
          <form method="post" 
                action="{% url 'user_app:work-item-toggle-archive' item.id %}"
                class="wi-restore-form"
                onsubmit="return confirm('Are you sure you want to restore this work item?');">
            {% csrf_token %}
            <button type="submit" class="wi-action-btn wi-restore-btn">
              <i class="fas fa-undo"></i>
              <span>Restore</span>
            </button>
          </form>
        </div>
      {% else %}
        <!-- Admin/System archived items are read-only -->
        <div class="wi-read-only">
          <i class="fas fa-lock"></i>
          <span>This item is archived and cannot be modified</span>
        </div>
      {% endif %}
    </footer>

  </article>
  {% endwith %}
  {% endfor %}

</section>

<!-- REASON MODAL (Hidden by default) -->
<div class="wi-reason-modal" id="reasonModal">
  <div class="wi-reason-modal-overlay"></div>
  <div class="wi-reason-modal-content">
    <div class="wi-reason-modal-header">
      <h3 class="wi-reason-modal-title">
        <i class="fas fa-info-circle"></i>
        Archive Details
      </h3>
      <button class="wi-reason-modal-close" aria-label="Close">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="wi-reason-modal-body">
      <div class="wi-reason-info">
        <div class="wi-reason-item">
          <div class="wi-reason-label">Archived by:</div>
          <div class="wi-reason-value" id="modalAdmin"></div>
        </div>
        <div class="wi-reason-item">
          <div class="wi-reason-label">Date:</div>
          <div class="wi-reason-value" id="modalDate"></div>
        </div>
        <div class="wi-reason-item">
          <div class="wi-reason-label">Reason:</div>
          <div class="wi-reason-value wi-reason-primary" id="modalReason"></div>
        </div>
        <div class="wi-reason-item wi-reason-note-item" id="noteItem">
          <div class="wi-reason-label">Note:</div>
          <div class="wi-reason-value wi-reason-note" id="modalNote"></div>
        </div>
      </div>
    </div>
    <div class="wi-reason-modal-footer">
      <button class="wi-reason-modal-ok">OK</button>
    </div>
  </div>
</div>

{% else %}

<section class="wi-empty-state">
  <div class="wi-empty-icon">
    <i class="fas fa-archive fa-3x"></i>
  </div>
  <h3 class="wi-empty-title">No Archived Work Items</h3>
  <p class="wi-empty-text">
    When you archive work items, they'll appear here for reference.
  </p>
  <a href="{% url 'user_app:work-items' %}" class="wi-empty-action">
    <i class="fas fa-arrow-left"></i>
    Back to Active Work Items
  </a>
</section>

{% endif %}

<!-- =========================
     STYLES FOR ARCHIVED ITEMS
========================= -->
<style>
/* =============================
   COLOR PALETTES BY ARCHIVE TYPE
============================= */
:root {
  /* USER ARCHIVED - Muted Brown Palette */
  --user-ribbon-bg: #8b7355;           /* Muted brown */
  --user-ribbon-text: #ffffff;
  --user-card-bg: #f9f7f3;             /* Warm light background */
  --user-card-border: #e0d7cc;         /* Warm border */
  --user-card-text: #5d4037;           /* Dark brown text */
  --user-accent: #a67c52;              /* Lighter brown accent */
  --user-banner-bg: rgba(139, 115, 85, 0.1);
  --user-banner-border: rgba(139, 115, 85, 0.2);
  --user-banner-text: #5d4037;
  --user-btn-primary: #8b7355;
  --user-btn-hover: #7a6247;
  
  /* ADMIN ARCHIVED - Muted Black/Grey/Red Palette */
  --admin-ribbon-bg: #2c3e50;          /* Dark slate/black */
  --admin-ribbon-text: #ffffff;
  --admin-card-bg: #f5f5f5;            /* Cool grey background */
  --admin-card-border: #e0e0e0;        /* Light grey border */
  --admin-card-text: #333333;          /* Near black text */
  --admin-accent: #7f8c8d;             /* Grey accent */
  --admin-banner-bg: rgba(44, 62, 80, 0.1);  /* Dark slate tint */
  --admin-banner-border: rgba(44, 62, 80, 0.2);
  --admin-banner-text: #2c3e50;
  --admin-red-accent: #c62828;         /* Muted red for accents */
  --admin-info-color: #2c3e50;         /* For info button */
  
  /* SYSTEM ARCHIVED - Muted Purple Palette */
  --system-ribbon-bg: #6c5b7b;         /* Muted purple */
  --system-ribbon-text: #ffffff;
  --system-card-bg: #f8f6fa;           /* Light purple tint */
  --system-card-border: #e6e0ed;       /* Light purple border */
  --system-card-text: #4a235a;         /* Dark purple text */
  --system-accent: #8e7cc3;            /* Purple accent */
  --system-banner-bg: rgba(108, 91, 123, 0.1);
  --system-banner-border: rgba(108, 91, 123, 0.2);
  --system-banner-text: #4a235a;
}

/* =============================
   CARD GRID
============================= */
.wi-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
  gap: 20px;
  margin-top: 0;
}

/* =============================
   ARCHIVED CARD STYLES BY TYPE
============================= */
.wi-card-archived {
  border-radius: 14px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  transition: all 0.2s ease;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  height: 100%;
  position: relative;
  border-left: 4px solid;
}

/* User Archived */
.archive-type-user {
  background: var(--user-card-bg);
  border: 1px solid var(--user-card-border);
  border-left-color: var(--user-ribbon-bg);
  box-shadow: 0 2px 8px rgba(139, 115, 85, 0.08);
}

.archive-type-user:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(139, 115, 85, 0.12);
  border-color: var(--user-accent);
}

/* Admin Archived */
.archive-type-admin {
  background: var(--admin-card-bg);
  border: 1px solid var(--admin-card-border);
  border-left-color: var(--admin-ribbon-bg);
  box-shadow: 0 2px 8px rgba(44, 62, 80, 0.08);
}

.archive-type-admin:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(44, 62, 80, 0.12);
  border-color: var(--admin-accent);
}

/* System Archived */
.archive-type-system {
  background: var(--system-card-bg);
  border: 1px solid var(--system-card-border);
  border-left-color: var(--system-ribbon-bg);
  box-shadow: 0 2px 8px rgba(108, 91, 123, 0.08);
}

.archive-type-system:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(108, 91, 123, 0.12);
  border-color: var(--system-accent);
}

/* =============================
   CARD HEADER
============================= */
.wi-card-header {
  padding: 16px 18px 12px;
  border-bottom: 1px solid;
  position: relative;
  min-height: 60px;
}

.archive-type-user .wi-card-header {
  border-bottom-color: var(--user-card-border);
}

.archive-type-admin .wi-card-header {
  border-bottom-color: var(--admin-card-border);
}

.archive-type-system .wi-card-header {
  border-bottom-color: var(--system-card-border);
}

.wi-title-row {
  padding-right: 50px; /* Space for action buttons */
}

.wi-card-title {
  font-size: 1rem;
  font-weight: 700;
  margin: 0;
  line-height: 1.4;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
}

.archive-type-user .wi-card-title {
  color: var(--user-card-text);
}

.archive-type-admin .wi-card-title {
  color: var(--admin-card-text);
}

.archive-type-system .wi-card-title {
  color: var(--system-card-text);
}

.wi-card-title i {
  margin-right: 6px;
  font-size: 0.9rem;
}

.archive-type-user .wi-card-title i {
  color: var(--user-accent);
}

.archive-type-admin .wi-card-title i {
  color: var(--admin-accent);
}

.archive-type-system .wi-card-title i {
  color: var(--system-accent);
}

/* =============================
   ACTION AREA
============================= */
.wi-card-actions {
  position: absolute;
  top: 14px;
  right: 14px;
}

/* Three-dot menu for user archived */
.wi-card-menu {
  position: relative;
}

.wi-menu-btn {
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 4px;
  transition: background 0.2s;
}

.archive-type-user .wi-menu-btn {
  color: var(--user-accent);
}

.archive-type-user .wi-menu-btn:hover {
  background: rgba(139, 115, 85, 0.1);
}

.wi-menu-dropdown {
  display: none;
  position: absolute;
  right: 0;
  top: 30px;
  background: white;
  border: 1px solid;
  border-radius: 8px;
  min-width: 160px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  z-index: 50;
  overflow: hidden;
}

.archive-type-user .wi-menu-dropdown {
  border-color: var(--user-card-border);
}

.wi-menu-dropdown a,
.wi-menu-action {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 12px;
  font-size: 0.8rem;
  background: none;
  border: none;
  width: 100%;
  text-decoration: none;
  cursor: pointer;
  text-align: left;
  color: #333;
}

.wi-menu-dropdown a:hover,
.wi-menu-action:hover {
  background: #f5f5f5;
}

.wi-menu-action i {
  color: var(--user-ribbon-bg);
}

.wi-card-menu.open .wi-menu-dropdown {
  display: block;
}

/* Info button for admin archived */
.wi-reason-btn {
  background: none;
  border: none;
  font-size: 1.1rem;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 4px;
  transition: all 0.2s;
  color: var(--admin-info-color);
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.wi-reason-btn:hover {
  background: rgba(44, 62, 80, 0.1);
  transform: scale(1.1);
}

.wi-reason-btn i {
  font-size: 1rem;
}

/* =============================
   REASON MODAL STYLES
============================= */
.wi-reason-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1060;
  align-items: center;
  justify-content: center;
}

.wi-reason-modal.active {
  display: flex;
}

.wi-reason-modal-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(2px);
}

.wi-reason-modal-content {
  position: relative;
  background: white;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  z-index: 1001;
  animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.wi-reason-modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  border-bottom: 1px solid #e0e0e0;
  background: var(--admin-card-bg);
  border-radius: 12px 12px 0 0;
}

.wi-reason-modal-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--admin-card-text);
  margin: 0;
  display: flex;
  align-items: center;
  gap: 8px;
}

.wi-reason-modal-title i {
  color: var(--admin-info-color);
}

.wi-reason-modal-close {
  background: none;
  border: none;
  font-size: 1.2rem;
  cursor: pointer;
  padding: 4px 8px;
  color: #666;
  border-radius: 4px;
  transition: all 0.2s;
}

.wi-reason-modal-close:hover {
  background: #f0f0f0;
  color: #333;
}

.wi-reason-modal-body {
  padding: 20px;
}

.wi-reason-info {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.wi-reason-item {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.wi-reason-label {
  font-size: 0.85rem;
  font-weight: 600;
  color: #666;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.wi-reason-value {
  font-size: 1rem;
  color: #333;
  line-height: 1.4;
}

.wi-reason-primary {
  font-weight: 600;
  color: var(--admin-info-color);
  padding: 8px 12px;
  background: rgba(44, 62, 80, 0.1);
  border-radius: 6px;
  border-left: 3px solid var(--admin-info-color);
}

.wi-reason-note-item {
  display: none;
}

.wi-reason-note-item.has-note {
  display: flex;
}

.wi-reason-note {
  font-style: italic;
  color: #555;
  padding: 8px 12px;
  background: #f9f9f9;
  border-radius: 6px;
  border-left: 3px solid #ddd;
}

.wi-reason-modal-footer {
  padding: 16px 20px;
  border-top: 1px solid #e0e0e0;
  text-align: right;
}

.wi-reason-modal-ok {
  background: var(--admin-info-color);
  color: white;
  border: none;
  padding: 8px 20px;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.wi-reason-modal-ok:hover {
  background: #1a252f;
  transform: translateY(-1px);
  box-shadow: 0 3px 8px rgba(44, 62, 80, 0.3);
}

/* =============================
   ARCHIVED BANNER
============================= */
.wi-archived-banner {
  margin: 0 18px;
  border-radius: 8px;
  overflow: hidden;
  border: 1px solid;
}

.banner-user {
  background: var(--user-banner-bg);
  border-color: var(--user-banner-border);
}

.banner-admin {
  background: var(--admin-banner-bg);
  border-color: var(--admin-banner-border);
}

.banner-system {
  background: var(--system-banner-bg);
  border-color: var(--system-banner-border);
}

.wi-admin-archived,
.wi-user-archived,
.wi-system-archived {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 12px;
  font-size: 0.85rem;
}

.banner-user .wi-user-archived {
  color: var(--user-banner-text);
}

.banner-admin .wi-admin-archived {
  color: var(--admin-banner-text);
}

.banner-system .wi-system-archived {
  color: var(--system-banner-text);
}

.wi-archived-banner i {
  font-size: 1rem;
  margin-top: 2px;
  flex-shrink: 0;
}

.wi-archived-details {
  flex: 1;
}

.wi-archived-details strong {
  display: block;
  margin-bottom: 4px;
  font-size: 0.9rem;
}

.wi-archived-meta {
  font-size: 0.8rem;
  color: inherit;
  opacity: 0.8;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 4px;
}

.wi-archived-reason,
.wi-archived-note {
  font-size: 0.8rem;
  margin-top: 4px;
  display: flex;
  align-items: flex-start;
  gap: 4px;
}

.wi-archived-reason i {
  font-size: 0.8rem;
  margin-top: 0;
}

.wi-archived-note {
  font-style: italic;
  opacity: 0.7;
}

/* =============================
   CARD BODY (Rest of styles remain the same...)
============================= */
.wi-card-body {
  padding: 16px 18px;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* HORIZONTAL STATUS ROW */
.wi-status-row-horizontal {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

/* STATUS SECTIONS */
.wi-status-section {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.wi-section-label {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.02em;
}

.archive-type-user .wi-section-label {
  color: var(--user-accent);
}

.archive-type-admin .wi-section-label {
  color: var(--admin-accent);
}

.archive-type-system .wi-section-label {
  color: var(--system-accent);
}

.wi-section-label i {
  font-size: 0.65rem;
}

/* ARCHIVE STATUS BADGE */
.wi-archive-badge-large {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 7px 11px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 700;
  text-transform: capitalize;
  border: 1px solid;
  align-self: flex-start;
}

.wi-archive-badge-large i {
  font-size: 0.7rem;
}

.wi-archive-badge-large.archive-user {
  background: rgba(139, 115, 85, 0.15);
  color: var(--user-banner-text);
  border-color: rgba(139, 115, 85, 0.3);
}

.wi-archive-badge-large.archive-admin {
  background: rgba(44, 62, 80, 0.15);
  color: var(--admin-banner-text);
  border-color: rgba(44, 62, 80, 0.3);
}

.wi-archive-badge-large.archive-system {
  background: rgba(108, 91, 123, 0.15);
  color: var(--system-banner-text);
  border-color: rgba(108, 91, 123, 0.3);
}

/* REVIEW STATUS BADGE (Muted colors) */
.wi-review-badge-large {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 7px 11px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 700;
  text-transform: capitalize;
  border: 1px solid;
  align-self: flex-start;
}

.wi-review-badge-large i {
  font-size: 0.7rem;
}

.wi-review-badge-large.review-pending {
  background: rgba(139, 111, 214, 0.15);
  color: #5c4591;
  border-color: rgba(139, 111, 214, 0.3);
}

.wi-review-badge-large.review-approved {
  background: rgba(63, 163, 140, 0.15);
  color: #2a6f5d;
  border-color: rgba(63, 163, 140, 0.3);
}

.wi-review-badge-large.review-revision {
  background: rgba(192, 84, 94, 0.15);
  color: #8e3d45;
  border-color: rgba(192, 84, 94, 0.3);
}

/* FINAL STATUS INFO */
.wi-info-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid;
  margin-top: 2px;
}

.archive-type-user .wi-info-row {
  background: rgba(139, 115, 85, 0.05);
  border-color: var(--user-card-border);
}

.archive-type-admin .wi-info-row {
  background: rgba(44, 62, 80, 0.05);
  border-color: var(--admin-card-border);
}

.archive-type-system .wi-info-row {
  background: rgba(108, 91, 123, 0.05);
  border-color: var(--system-card-border);
}

/* Info header */
.wi-info-header {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 0.7rem;
  font-weight: 600;
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.02em;
}

.archive-type-user .wi-info-header {
  color: var(--user-accent);
}

.archive-type-admin .wi-info-header {
  color: var(--admin-accent);
}

.archive-type-system .wi-info-header {
  color: var(--system-accent);
}

.wi-info-header i {
  font-size: 0.65rem;
}

/* Info content */
.wi-info-content {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.wi-info-date {
  font-size: 0.875rem;
  font-weight: 700;
}

.archive-type-user .wi-info-date {
  color: var(--user-card-text);
}

.archive-type-admin .wi-info-date {
  color: var(--admin-card-text);
}

.archive-type-system .wi-info-date {
  color: var(--system-card-text);
}

.wi-info-time {
  font-size: 0.75rem;
  font-weight: 500;
  opacity: 0.8;
}

/* Final status */
.wi-final-content {
  font-size: 0.875rem;
  font-weight: 700;
  padding: 6px 10px;
  border-radius: 8px;
  text-align: center;
  border: 1px solid;
  background: white;
}

.wi-final-content.status-done {
  color: #4a7d35;
  border-color: rgba(111, 179, 77, 0.3);
  background: rgba(111, 179, 77, 0.1);
}

.wi-final-content.status-incomplete {
  color: #a84444;
  border-color: rgba(226, 102, 102, 0.3);
  background: rgba(226, 102, 102, 0.1);
}

/* =============================
   CARD FOOTER
============================= */
.wi-card-footer {
  padding: 14px 18px;
  border-top: 1px solid;
  margin-top: auto;
}

.archive-type-user .wi-card-footer {
  border-top-color: var(--user-card-border);
  background: rgba(139, 115, 85, 0.03);
}

.archive-type-admin .wi-card-footer {
  border-top-color: var(--admin-card-border);
  background: rgba(44, 62, 80, 0.03);
}

.archive-type-system .wi-card-footer {
  border-top-color: var(--system-card-border);
  background: rgba(108, 91, 123, 0.03);
}

/* Action buttons */
.wi-footer-actions {
  display: flex;
  gap: 10px;
}

.wi-action-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 600;
  transition: all 0.2s ease;
  flex: 1;
  justify-content: center;
  text-decoration: none;
  border: none;
  cursor: pointer;
}

.wi-action-btn i {
  font-size: 0.75rem;
}

.wi-view-btn {
  background: var(--user-btn-primary);
  color: white;
}

.wi-view-btn:hover {
  background: var(--user-btn-hover);
  transform: translateY(-1px);
  box-shadow: 0 3px 8px rgba(139, 115, 85, 0.3);
}

.wi-restore-btn {
  background: var(--user-accent);
  color: white;
}

.wi-restore-btn:hover {
  background: #8b6b3d;
  transform: translateY(-1px);
  box-shadow: 0 3px 8px rgba(139, 107, 61, 0.3);
}

/* Read-only state */
.wi-read-only {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 10px;
  border-radius: 8px;
  font-size: 0.85rem;
}

.archive-type-admin .wi-read-only {
  background: rgba(44, 62, 80, 0.1);
  color: var(--admin-banner-text);
}

.archive-type-system .wi-read-only {
  background: rgba(108, 91, 123, 0.1);
  color: var(--system-banner-text);
}

.wi-read-only i {
  font-size: 0.8rem;
}

.archive-type-admin .wi-read-only i {
  color: var(--admin-red-accent);
}

.archive-type-system .wi-read-only i {
  color: var(--system-ribbon-bg);
}

/* =============================
   EMPTY STATE
============================= */
.wi-empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  text-align: center;
  background: var(--admin-card-bg);
  border: 2px dashed var(--admin-card-border);
  border-radius: 16px;
  margin-top: 20px;
}

.wi-empty-icon {
  color: var(--admin-accent);
  margin-bottom: 20px;
}

.wi-empty-title {
  font-size: 1.2rem;
  font-weight: 600;
  color: var(--admin-card-text);
  margin-bottom: 8px;
}

.wi-empty-text {
  font-size: 0.9rem;
  font-weight: 400;
  color: var(--admin-accent);
  margin-bottom: 20px;
  max-width: 300px;
}

.wi-empty-action {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  background: var(--admin-ribbon-bg);
  color: white;
  text-decoration: none;
  border-radius: 8px;
  font-size: 0.9rem;
  font-weight: 600;
  transition: all 0.2s ease;
}

.wi-empty-action:hover {
  background: #1a252f;
  transform: translateY(-1px);
  box-shadow: 0 3px 8px rgba(44, 62, 80, 0.3);
}

/* =============================
   RESPONSIVE
============================= */
@media (max-width: 1200px) {
  .wi-grid {
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  }
}

@media (max-width: 768px) {
  .wi-grid {
    grid-template-columns: 1fr;
    gap: 16px;
  }
  
  .wi-status-row-horizontal {
    grid-template-columns: 1fr;
    gap: 10px;
  }
  
  .wi-info-row {
    grid-template-columns: 1fr;
    gap: 10px;
  }
  
  .wi-card-header,
  .wi-card-body,
  .wi-card-footer {
    padding: 14px 16px;
  }
  
  .wi-footer-actions {
    flex-direction: column;
  }
  
  .wi-reason-modal-content {
    width: 95%;
    margin: 10px;
  }
}

@media (max-width: 480px) {
  .wi-card-title {
    font-size: 0.95rem;
  }
  
  .wi-archived-banner {
    margin: 0 12px;
  }
  
  .wi-admin-archived,
  .wi-user-archived,
  .wi-system-archived {
    flex-direction: column;
    gap: 8px;
  }
}
</style>

<script>
// Menu toggle functionality
document.addEventListener("click", function (e) {
  document.querySelectorAll(".wi-card-menu").forEach(menu => {
    if (!menu.contains(e.target)) {
      menu.classList.remove("open");
    }
  });

  const btn = e.target.closest(".wi-menu-btn");
  if (btn) {
    btn.closest(".wi-card-menu").classList.toggle("open");
  }
});

// Reason modal functionality
const reasonModal = document.getElementById('reasonModal');
const reasonBtns = document.querySelectorAll('.wi-reason-btn');

reasonBtns.forEach(btn => {
  btn.addEventListener('click', function() {
    const reason = this.getAttribute('data-reason');
    const note = this.getAttribute('data-note');
    const admin = this.getAttribute('data-admin');
    const date = this.getAttribute('data-date');
    
    // Set modal content
    document.getElementById('modalReason').textContent = reason;
    document.getElementById('modalAdmin').textContent = admin;
    document.getElementById('modalDate').textContent = date;
    
    // Handle note
    const noteItem = document.getElementById('noteItem');
    const modalNote = document.getElementById('modalNote');
    
    if (note && note.trim() !== '') {
      noteItem.classList.add('has-note');
      modalNote.textContent = note;
    } else {
      noteItem.classList.remove('has-note');
      modalNote.textContent = '';
    }
    
    // Show modal
    reasonModal.classList.add('active');
    document.body.style.overflow = 'hidden'; // Prevent scrolling
  });
});

// Close modal functionality
function closeReasonModal() {
  reasonModal.classList.remove('active');
  document.body.style.overflow = ''; // Restore scrolling
}

// Close modal when clicking overlay, close button, or OK button
reasonModal.querySelector('.wi-reason-modal-overlay').addEventListener('click', closeReasonModal);
reasonModal.querySelector('.wi-reason-modal-close').addEventListener('click', closeReasonModal);
reasonModal.querySelector('.wi-reason-modal-ok').addEventListener('click', closeReasonModal);

// Close modal with Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' && reasonModal.classList.contains('active')) {
    closeReasonModal();
  }
});

// Confirmation for restore actions
document.addEventListener("submit", function(e) {
  if (e.target.classList.contains("wi-restore-form")) {
    if (!confirm("Are you sure you want to restore this work item to active status?")) {
      e.preventDefault();
    }
  }
});
</script>